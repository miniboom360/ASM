"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.VXETablePluginExportXLSX = void 0;

var _xeUtils = _interopRequireDefault(require("xe-utils"));

var _exceljs = _interopRequireDefault(require("exceljs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var vxetable;
var defaultHeaderBackgroundColor = 'f8f8f9';
var defaultCellFontColor = '606266';
var defaultCellBorderStyle = 'thin';
var defaultCellBorderColor = 'e8eaec';

function getCellLabel(column, cellValue) {
  if (cellValue) {
    if (column.type === 'seq') {
      return _xeUtils["default"].toValueString(cellValue);
    }

    switch (column.cellType) {
      case 'string':
        return _xeUtils["default"].toValueString(cellValue);

      case 'number':
        if (!isNaN(cellValue)) {
          return Number(cellValue);
        }

        break;

      default:
        if (cellValue.length < 12 && !isNaN(cellValue)) {
          return Number(cellValue);
        }

        break;
    }
  }

  return cellValue;
}

function getFooterData(opts, footerData) {
  var footerFilterMethod = opts.footerFilterMethod;
  return footerFilterMethod ? footerData.filter(function (items, index) {
    return footerFilterMethod({
      items: items,
      $rowIndex: index
    });
  }) : footerData;
}

function getFooterCellValue($table, opts, rows, column) {
  var cellValue = getCellLabel(column, rows[$table.getVMColumnIndex(column)]);
  return cellValue;
}

function getValidColumn(column) {
  var childNodes = column.childNodes;
  var isColGroup = childNodes && childNodes.length;

  if (isColGroup) {
    return getValidColumn(childNodes[0]);
  }

  return column;
}

function setExcelRowHeight(excelRow, height) {
  if (height) {
    excelRow.height = _xeUtils["default"].floor(height * 0.75, 12);
  }
}

function setExcelCellStyle(excelCell, align) {
  excelCell.protection = {
    locked: false
  };
  excelCell.alignment = {
    vertical: 'middle',
    horizontal: align || 'left'
  };
}

function getDefaultBorderStyle() {
  return {
    top: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    },
    left: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    },
    bottom: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    },
    right: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    }
  };
}

function exportXLSX(params) {
  var msgKey = 'xlsx';
  var _vxetable = vxetable,
      modal = _vxetable.modal,
      t = _vxetable.t;
  var $table = params.$table,
      options = params.options,
      columns = params.columns,
      colgroups = params.colgroups,
      datas = params.datas;
  var props = $table.props,
      reactData = $table.reactData;
  var allHeaderAlign = props.headerAlign,
      allAlign = props.align,
      allFooterAlign = props.footerAlign;
  var rowHeight = reactData.rowHeight;
  var message = options.message,
      sheetName = options.sheetName,
      isHeader = options.isHeader,
      isFooter = options.isFooter,
      isMerge = options.isMerge,
      isColgroup = options.isColgroup,
      original = options.original,
      useStyle = options.useStyle,
      sheetMethod = options.sheetMethod;
  var showMsg = message !== false;
  var mergeCells = $table.getMergeCells();
  var colList = [];
  var footList = [];
  var sheetCols = [];
  var sheetMerges = [];
  var beforeRowCount = 0;
  var colHead = {};
  columns.forEach(function (column) {
    var id = column.id,
        field = column.field,
        renderWidth = column.renderWidth;
    colHead[id] = original ? field : column.getTitle();
    sheetCols.push({
      key: id,
      width: _xeUtils["default"].ceil(renderWidth / 8, 1)
    });
  }); // 处理表头

  if (isHeader) {
    // 处理分组
    if (isColgroup && !original && colgroups) {
      colgroups.forEach(function (cols, rIndex) {
        var groupHead = {};
        columns.forEach(function (column) {
          groupHead[column.id] = null;
        });
        cols.forEach(function (column) {
          var _colSpan = column._colSpan,
              _rowSpan = column._rowSpan;
          var validColumn = getValidColumn(column);
          var columnIndex = columns.indexOf(validColumn);
          groupHead[validColumn.id] = original ? validColumn.field : column.getTitle();

          if (_colSpan > 1 || _rowSpan > 1) {
            sheetMerges.push({
              s: {
                r: rIndex,
                c: columnIndex
              },
              e: {
                r: rIndex + _rowSpan - 1,
                c: columnIndex + _colSpan - 1
              }
            });
          }
        });
        colList.push(groupHead);
      });
    } else {
      colList.push(colHead);
    }

    beforeRowCount += colList.length;
  } // 处理合并


  if (isMerge && !original) {
    mergeCells.forEach(function (mergeItem) {
      var mergeRowIndex = mergeItem.row,
          mergeRowspan = mergeItem.rowspan,
          mergeColIndex = mergeItem.col,
          mergeColspan = mergeItem.colspan;
      sheetMerges.push({
        s: {
          r: mergeRowIndex + beforeRowCount,
          c: mergeColIndex
        },
        e: {
          r: mergeRowIndex + beforeRowCount + mergeRowspan - 1,
          c: mergeColIndex + mergeColspan - 1
        }
      });
    });
  }

  var rowList = datas.map(function (item) {
    var rest = {};
    columns.forEach(function (column) {
      rest[column.id] = getCellLabel(column, item[column.id]);
    });
    return rest;
  });
  beforeRowCount += rowList.length; // 处理表尾

  if (isFooter) {
    var _$table$getTableData = $table.getTableData(),
        footerData = _$table$getTableData.footerData;

    var footers = getFooterData(options, footerData);
    var mergeFooterItems = $table.getMergeFooterItems(); // 处理合并

    if (isMerge && !original) {
      mergeFooterItems.forEach(function (mergeItem) {
        var mergeRowIndex = mergeItem.row,
            mergeRowspan = mergeItem.rowspan,
            mergeColIndex = mergeItem.col,
            mergeColspan = mergeItem.colspan;
        sheetMerges.push({
          s: {
            r: mergeRowIndex + beforeRowCount,
            c: mergeColIndex
          },
          e: {
            r: mergeRowIndex + beforeRowCount + mergeRowspan - 1,
            c: mergeColIndex + mergeColspan - 1
          }
        });
      });
    }

    footers.forEach(function (rows) {
      var item = {};
      columns.forEach(function (column) {
        item[column.id] = getFooterCellValue($table, options, rows, column);
      });
      footList.push(item);
    });
  }

  var exportMethod = function exportMethod() {
    var workbook = new _exceljs["default"].Workbook();
    var sheet = workbook.addWorksheet(sheetName);
    workbook.creator = 'vxe-table';
    sheet.columns = sheetCols;

    if (isHeader) {
      sheet.addRows(colList).forEach(function (excelRow) {
        if (useStyle) {
          setExcelRowHeight(excelRow, rowHeight);
        }

        excelRow.eachCell(function (excelCell) {
          var excelCol = sheet.getColumn(excelCell.col);
          var column = $table.getColumnById(excelCol.key);
          var headerAlign = column.headerAlign,
              align = column.align;
          setExcelCellStyle(excelCell, headerAlign || align || allHeaderAlign || allAlign);

          if (useStyle) {
            Object.assign(excelCell, {
              font: {
                bold: true,
                color: {
                  argb: defaultCellFontColor
                }
              },
              fill: {
                type: 'pattern',
                pattern: 'solid',
                fgColor: {
                  argb: defaultHeaderBackgroundColor
                }
              },
              border: getDefaultBorderStyle()
            });
          }
        });
      });
    }

    sheet.addRows(rowList).forEach(function (excelRow) {
      if (useStyle) {
        setExcelRowHeight(excelRow, rowHeight);
      }

      excelRow.eachCell(function (excelCell) {
        var excelCol = sheet.getColumn(excelCell.col);
        var column = $table.getColumnById(excelCol.key);

        if (column) {
          var align = column.align;
          setExcelCellStyle(excelCell, align || allAlign);

          if (useStyle) {
            Object.assign(excelCell, {
              font: {
                color: {
                  argb: defaultCellFontColor
                }
              },
              border: getDefaultBorderStyle()
            });
          }
        }
      });
    });

    if (isFooter) {
      sheet.addRows(footList).forEach(function (excelRow) {
        if (useStyle) {
          setExcelRowHeight(excelRow, rowHeight);
        }

        excelRow.eachCell(function (excelCell) {
          var excelCol = sheet.getColumn(excelCell.col);
          var column = $table.getColumnById(excelCol.key);

          if (column) {
            var footerAlign = column.footerAlign,
                align = column.align;
            setExcelCellStyle(excelCell, footerAlign || align || allFooterAlign || allAlign);

            if (useStyle) {
              Object.assign(excelCell, {
                font: {
                  color: {
                    argb: defaultCellFontColor
                  }
                },
                border: getDefaultBorderStyle()
              });
            }
          }
        });
      });
    }

    if (useStyle && sheetMethod) {
      sheetMethod({
        options: options,
        workbook: workbook,
        worksheet: sheet,
        columns: columns,
        colgroups: colgroups,
        datas: datas,
        $table: $table
      });
    }

    sheetMerges.forEach(function (_ref) {
      var s = _ref.s,
          e = _ref.e;
      sheet.mergeCells(s.r + 1, s.c + 1, e.r + 1, e.c + 1);
    });
    workbook.xlsx.writeBuffer().then(function (buffer) {
      var blob = new Blob([buffer], {
        type: 'application/octet-stream'
      }); // 导出 xlsx

      downloadFile(params, blob, options);

      if (showMsg && modal) {
        modal.close(msgKey);
        modal.message({
          content: t('vxe.table.expSuccess'),
          status: 'success'
        });
      }
    });
  };

  if (showMsg && modal) {
    modal.message({
      id: msgKey,
      content: t('vxe.table.expLoading'),
      status: 'loading',
      duration: -1
    });
    setTimeout(exportMethod, 1500);
  } else {
    exportMethod();
  }
}

function downloadFile(params, blob, options) {
  var _vxetable2 = vxetable,
      modal = _vxetable2.modal,
      t = _vxetable2.t;
  var message = options.message,
      filename = options.filename,
      type = options.type;
  var showMsg = message !== false;

  if (window.Blob) {
    if (navigator.msSaveBlob) {
      navigator.msSaveBlob(blob, "".concat(filename, ".").concat(type));
    } else {
      var linkElem = document.createElement('a');
      linkElem.target = '_blank';
      linkElem.download = "".concat(filename, ".").concat(type);
      linkElem.href = URL.createObjectURL(blob);
      document.body.appendChild(linkElem);
      linkElem.click();
      document.body.removeChild(linkElem);
    }
  } else {
    if (showMsg && modal) {
      modal.alert({
        content: t('vxe.error.notExp'),
        status: 'error'
      });
    }
  }
}

function checkImportData(tableFields, fields) {
  return fields.some(function (field) {
    return tableFields.indexOf(field) > -1;
  });
}

function importError(params) {
  var _vxetable3 = vxetable,
      modal = _vxetable3.modal,
      t = _vxetable3.t;
  var $table = params.$table,
      options = params.options;
  var internalData = $table.internalData;
  var _importReject = internalData._importReject;
  var showMsg = options.message !== false;

  if (showMsg && modal) {
    modal.message({
      content: t('vxe.error.impFields'),
      status: 'error'
    });
  }

  if (_importReject) {
    _importReject({
      status: false
    });
  }
}

function importXLSX(params) {
  var _vxetable4 = vxetable,
      modal = _vxetable4.modal,
      t = _vxetable4.t;
  var $table = params.$table,
      columns = params.columns,
      options = params.options,
      file = params.file;
  var internalData = $table.internalData;
  var _importResolve = internalData._importResolve;
  var showMsg = options.message !== false;
  var fileReader = new FileReader();

  fileReader.onerror = function () {
    importError(params);
  };

  fileReader.onload = function (evnt) {
    var tableFields = [];
    columns.forEach(function (column) {
      var field = column.field;

      if (field) {
        tableFields.push(field);
      }
    });
    var workbook = new _exceljs["default"].Workbook();
    var readerTarget = evnt.target;

    if (readerTarget) {
      workbook.xlsx.load(readerTarget.result).then(function (wb) {
        var firstSheet = wb.worksheets[0];

        if (firstSheet) {
          var sheetValues = firstSheet.getSheetValues();

          var fieldIndex = _xeUtils["default"].findIndexOf(sheetValues, function (list) {
            return list && list.length > 0;
          });

          var fields = sheetValues[fieldIndex];
          var status = checkImportData(tableFields, fields);

          if (status) {
            var records = sheetValues.slice(fieldIndex).map(function (list) {
              var item = {};
              list.forEach(function (cellValue, cIndex) {
                item[fields[cIndex]] = cellValue;
              });
              var record = {};
              tableFields.forEach(function (field) {
                record[field] = _xeUtils["default"].isUndefined(item[field]) ? null : item[field];
              });
              return record;
            });
            $table.createData(records).then(function (data) {
              var loadRest;

              if (options.mode === 'insert') {
                loadRest = $table.insertAt(data, -1);
              } else {
                loadRest = $table.reloadData(data);
              }

              return loadRest.then(function () {
                if (_importResolve) {
                  _importResolve({
                    status: true
                  });
                }
              });
            });

            if (showMsg && modal) {
              modal.message({
                content: t('vxe.table.impSuccess', [records.length]),
                status: 'success'
              });
            }
          } else {
            importError(params);
          }
        } else {
          importError(params);
        }
      });
    } else {
      importError(params);
    }
  };

  fileReader.readAsArrayBuffer(file);
}

function handleImportEvent(params) {
  if (params.options.type === 'xlsx') {
    importXLSX(params);
    return false;
  }
}

function handleExportEvent(params) {
  if (params.options.type === 'xlsx') {
    exportXLSX(params);
    return false;
  }
}
/**
 * 基于 vxe-table 表格的增强插件，支持导出 xlsx 格式
 */


var VXETablePluginExportXLSX = {
  install: function install(vxetablecore) {
    var setup = vxetablecore.setup,
        interceptor = vxetablecore.interceptor;
    vxetable = vxetablecore;
    setup({
      "export": {
        types: {
          xlsx: 0
        }
      }
    });
    interceptor.mixin({
      'event.import': handleImportEvent,
      'event.export': handleExportEvent
    });
  }
};
exports.VXETablePluginExportXLSX = VXETablePluginExportXLSX;

if (typeof window !== 'undefined' && window.VXETable && window.VXETable.use) {
  window.VXETable.use(VXETablePluginExportXLSX);
}

var _default = VXETablePluginExportXLSX;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiaW5kZXguanMiXSwibmFtZXMiOlsidnhldGFibGUiLCJkZWZhdWx0SGVhZGVyQmFja2dyb3VuZENvbG9yIiwiZGVmYXVsdENlbGxGb250Q29sb3IiLCJkZWZhdWx0Q2VsbEJvcmRlclN0eWxlIiwiZGVmYXVsdENlbGxCb3JkZXJDb2xvciIsImdldENlbGxMYWJlbCIsImNvbHVtbiIsImNlbGxWYWx1ZSIsInR5cGUiLCJYRVV0aWxzIiwidG9WYWx1ZVN0cmluZyIsImNlbGxUeXBlIiwiaXNOYU4iLCJOdW1iZXIiLCJsZW5ndGgiLCJnZXRGb290ZXJEYXRhIiwib3B0cyIsImZvb3RlckRhdGEiLCJmb290ZXJGaWx0ZXJNZXRob2QiLCJmaWx0ZXIiLCJpdGVtcyIsImluZGV4IiwiJHJvd0luZGV4IiwiZ2V0Rm9vdGVyQ2VsbFZhbHVlIiwiJHRhYmxlIiwicm93cyIsImdldFZNQ29sdW1uSW5kZXgiLCJnZXRWYWxpZENvbHVtbiIsImNoaWxkTm9kZXMiLCJpc0NvbEdyb3VwIiwic2V0RXhjZWxSb3dIZWlnaHQiLCJleGNlbFJvdyIsImhlaWdodCIsImZsb29yIiwic2V0RXhjZWxDZWxsU3R5bGUiLCJleGNlbENlbGwiLCJhbGlnbiIsInByb3RlY3Rpb24iLCJsb2NrZWQiLCJhbGlnbm1lbnQiLCJ2ZXJ0aWNhbCIsImhvcml6b250YWwiLCJnZXREZWZhdWx0Qm9yZGVyU3R5bGUiLCJ0b3AiLCJzdHlsZSIsImNvbG9yIiwiYXJnYiIsImxlZnQiLCJib3R0b20iLCJyaWdodCIsImV4cG9ydFhMU1giLCJwYXJhbXMiLCJtc2dLZXkiLCJtb2RhbCIsInQiLCJvcHRpb25zIiwiY29sdW1ucyIsImNvbGdyb3VwcyIsImRhdGFzIiwicHJvcHMiLCJyZWFjdERhdGEiLCJhbGxIZWFkZXJBbGlnbiIsImhlYWRlckFsaWduIiwiYWxsQWxpZ24iLCJhbGxGb290ZXJBbGlnbiIsImZvb3RlckFsaWduIiwicm93SGVpZ2h0IiwibWVzc2FnZSIsInNoZWV0TmFtZSIsImlzSGVhZGVyIiwiaXNGb290ZXIiLCJpc01lcmdlIiwiaXNDb2xncm91cCIsIm9yaWdpbmFsIiwidXNlU3R5bGUiLCJzaGVldE1ldGhvZCIsInNob3dNc2ciLCJtZXJnZUNlbGxzIiwiZ2V0TWVyZ2VDZWxscyIsImNvbExpc3QiLCJmb290TGlzdCIsInNoZWV0Q29scyIsInNoZWV0TWVyZ2VzIiwiYmVmb3JlUm93Q291bnQiLCJjb2xIZWFkIiwiZm9yRWFjaCIsImlkIiwiZmllbGQiLCJyZW5kZXJXaWR0aCIsImdldFRpdGxlIiwicHVzaCIsImtleSIsIndpZHRoIiwiY2VpbCIsImNvbHMiLCJySW5kZXgiLCJncm91cEhlYWQiLCJfY29sU3BhbiIsIl9yb3dTcGFuIiwidmFsaWRDb2x1bW4iLCJjb2x1bW5JbmRleCIsImluZGV4T2YiLCJzIiwiciIsImMiLCJlIiwibWVyZ2VJdGVtIiwibWVyZ2VSb3dJbmRleCIsInJvdyIsIm1lcmdlUm93c3BhbiIsInJvd3NwYW4iLCJtZXJnZUNvbEluZGV4IiwiY29sIiwibWVyZ2VDb2xzcGFuIiwiY29sc3BhbiIsInJvd0xpc3QiLCJtYXAiLCJpdGVtIiwicmVzdCIsImdldFRhYmxlRGF0YSIsImZvb3RlcnMiLCJtZXJnZUZvb3Rlckl0ZW1zIiwiZ2V0TWVyZ2VGb290ZXJJdGVtcyIsImV4cG9ydE1ldGhvZCIsIndvcmtib29rIiwiRXhjZWxKUyIsIldvcmtib29rIiwic2hlZXQiLCJhZGRXb3Jrc2hlZXQiLCJjcmVhdG9yIiwiYWRkUm93cyIsImVhY2hDZWxsIiwiZXhjZWxDb2wiLCJnZXRDb2x1bW4iLCJnZXRDb2x1bW5CeUlkIiwiT2JqZWN0IiwiYXNzaWduIiwiZm9udCIsImJvbGQiLCJmaWxsIiwicGF0dGVybiIsImZnQ29sb3IiLCJib3JkZXIiLCJ3b3Jrc2hlZXQiLCJ4bHN4Iiwid3JpdGVCdWZmZXIiLCJ0aGVuIiwiYnVmZmVyIiwiYmxvYiIsIkJsb2IiLCJkb3dubG9hZEZpbGUiLCJjbG9zZSIsImNvbnRlbnQiLCJzdGF0dXMiLCJkdXJhdGlvbiIsInNldFRpbWVvdXQiLCJmaWxlbmFtZSIsIndpbmRvdyIsIm5hdmlnYXRvciIsIm1zU2F2ZUJsb2IiLCJsaW5rRWxlbSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInRhcmdldCIsImRvd25sb2FkIiwiaHJlZiIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImNsaWNrIiwicmVtb3ZlQ2hpbGQiLCJhbGVydCIsImNoZWNrSW1wb3J0RGF0YSIsInRhYmxlRmllbGRzIiwiZmllbGRzIiwic29tZSIsImltcG9ydEVycm9yIiwiaW50ZXJuYWxEYXRhIiwiX2ltcG9ydFJlamVjdCIsImltcG9ydFhMU1giLCJmaWxlIiwiX2ltcG9ydFJlc29sdmUiLCJmaWxlUmVhZGVyIiwiRmlsZVJlYWRlciIsIm9uZXJyb3IiLCJvbmxvYWQiLCJldm50IiwicmVhZGVyVGFyZ2V0IiwibG9hZCIsInJlc3VsdCIsIndiIiwiZmlyc3RTaGVldCIsIndvcmtzaGVldHMiLCJzaGVldFZhbHVlcyIsImdldFNoZWV0VmFsdWVzIiwiZmllbGRJbmRleCIsImZpbmRJbmRleE9mIiwibGlzdCIsInJlY29yZHMiLCJzbGljZSIsImNJbmRleCIsInJlY29yZCIsImlzVW5kZWZpbmVkIiwiY3JlYXRlRGF0YSIsImRhdGEiLCJsb2FkUmVzdCIsIm1vZGUiLCJpbnNlcnRBdCIsInJlbG9hZERhdGEiLCJyZWFkQXNBcnJheUJ1ZmZlciIsImhhbmRsZUltcG9ydEV2ZW50IiwiaGFuZGxlRXhwb3J0RXZlbnQiLCJWWEVUYWJsZVBsdWdpbkV4cG9ydFhMU1giLCJpbnN0YWxsIiwidnhldGFibGVjb3JlIiwic2V0dXAiLCJpbnRlcmNlcHRvciIsInR5cGVzIiwibWl4aW4iLCJWWEVUYWJsZSIsInVzZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOzs7O0FBRUEsSUFBSUEsUUFBSjtBQWlCQSxJQUFNQyw0QkFBNEIsR0FBRyxRQUFyQztBQUNBLElBQU1DLG9CQUFvQixHQUFHLFFBQTdCO0FB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QUNKLFVBQVE7UUFDTkUsS0FBSyxFQUFFO1VBQ0wxRSxJQUFJLEVBQUU7UUFERDtNQUREO0lBREosQ0FBRCxDQUFMO0lBT0F5RSxXQUFXLENBQUNFLEtBQVosQ0FBa0I7TUFDaEIsZ0JBQWdCUixpQkFEQTtNQUVoQixnQkFBZ0JDO0lBRkEsQ0FBbEI7RUFJRDtBQWpCcUMsQ0FBakM7OztBQW9CUCxJQUFJLE9BQU92RCxNQUFQLEtBQWtCLFdBQWxCLElBQWlDQSxNQUFNLENBQUMrRCxRQUF4QyxJQUFvRC9ELE1BQU0sQ0FBQytELFFBQVAsQ0FBZ0JDLEdBQXhFLEVBQTZFO0VBQzNFaEUsTUFBTSxDQUFDK0QsUUFBUCxDQUFnQkMsR0FBaEIsQ0FBb0JSLHdCQUFwQjtBQUNEOztlQUVjQSx3QiIsImZpbGUiOiJpbmRleC5jb21tb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgWEVVdGlscyBmcm9tICd4ZS11dGlscydcclxuaW1wb3J0IHsgVlhFVGFibGVDb3JlLCBWeGVUYWJsZUNvbnN0cnVjdG9yLCBWeGVUYWJsZVByb3BUeXBlcywgVnhlVGFibGVEZWZpbmVzLCBWeGVHbG9iYWxJbnRlcmNlcHRvckhhbmRsZXMgfSBmcm9tICd2eGUtdGFibGUnXHJcbmltcG9ydCBFeGNlbEpTIGZyb20gJ2V4Y2VsanMnXHJcblxyXG5sZXQgdnhldGFibGU6VlhFVGFibGVDb3JlXHJcblxyXG5kZWNsYXJlIG1vZHVsZSAndnhlLXRhYmxlJyB7XHJcbiAgbmFtZXNwYWNlIFZ4ZVRhYmxlRGVmaW5lcyB7XHJcbiAgICBpbnRlcmZhY2UgRXh0b3J0U2hlZXRNZXRob2RQYXJhbXMge1xyXG4gICAgICB3b3JrYm9vazogRXhjZWxKUy5Xb3JrYm9vaztcclxuICAgICAgd29ya3NoZWV0OiBFeGNlbEpTLldvcmtzaGVldDtcclxuICAgIH1cclxuICAgIGludGVyZmFjZSBDb2x1bW5JbmZvIHtcclxuICAgICAgX3JvdzogYW55O1xyXG4gICAgICBfY29sU3BhbjogbnVtYmVyO1xyXG4gICAgICBfcm93U3BhbjogbnVtYmVyO1xyXG4gICAgICBjaGlsZE5vZGVzOiBWeGVUYWJsZURlZmluZXMuQ29sdW1uSW5mb1tdO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuY29uc3QgZGVmYXVsdEhlYWRlckJhY2tncm91bmRDb2xvciA9ICdmOGY4ZjknXHJcbmNvbnN0IGRlZmF1bHRDZWxsRm9udENvbG9yID0gJzYwNjI2NidcclxuY29uc3QgZGVmYXVsdENlbGxCb3JkZXJTdHlsZSA9ICd0aGluJ1xyXG5jb25zdCBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yID0gJ2U4ZWFlYydcclxuXHJcbmZ1bmN0aW9uIGdldENlbGxMYWJlbCAoY29sdW1uOiBWeGVUYWJsZURlZmluZXMuQ29sdW1uSW5mbywgY2VsbFZhbHVlOiBhbnkpIHtcclxuICBpZiAoY2VsbFZhbHVlKSB7XHJcbiAgICBpZiAoY29sdW1uLnR5cGUgPT09ICdzZXEnKSB7XHJcbiAgICAgIHJldHVybiBYRVV0aWxzLnRvVmFsdWVTdHJpbmcoY2VsbFZhbHVlKVxyXG4gICAgfVxyXG4gICAgc3dpdGNoIChjb2x1bW4uY2VsbFR5cGUpIHtcclxuICAgICAgY2FzZSAnc3RyaW5nJzpcclxuICAgICAgICByZXR1cm4gWEVVdGlscy50b1ZhbHVlU3RyaW5nKGNlbGxWYWx1ZSlcclxuICAgICAgY2FzZSAnbnVtYmVyJzpcclxuICAgICAgICBpZiAoIWlzTmFOKGNlbGxWYWx1ZSkpIHtcclxuICAgICAgICAgIHJldHVybiBOdW1iZXIoY2VsbFZhbHVlKVxyXG4gICAgICAgIH1cclxuICAgICAgICBicmVha1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIGlmIChjZWxsVmFsdWUubGVuZ3RoIDwgMTIgJiYgIWlzTmFOKGNlbGxWYWx1ZSkpIHtcclxuICAgICAgICAgIHJldHVybiBOdW1iZXIoY2VsbFZhbHVlKVxyXG4gICAgICAgIH1cclxuICAgICAgICBicmVha1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gY2VsbFZhbHVlXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEZvb3RlckRhdGEgKG9wdHM6IFZ4ZVRhYmxlUHJvcFR5cGVzLkV4cG9ydENvbmZpZywgZm9vdGVyRGF0YTogYW55W11bXSkge1xyXG4gIGNvbnN0IHsgZm9vdGVyRmlsdGVyTWV0aG9kIH0gPSBvcHRzXHJcbiAgcmV0dXJuIGZvb3RlckZpbHRlck1ldGhvZCA/IGZvb3RlckRhdGEuZmlsdGVyKChpdGVtcywgaW5kZXgpID0+IGZvb3RlckZpbHRlck1ldGhvZCh7IGl0ZW1zLCAkcm93SW5kZXg6IGluZGV4IH0pKSA6IGZvb3RlckRhdGFcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0Rm9vdGVyQ2VsbFZhbHVlICgkdGFibGU6IFZ4ZVRhYmxlQ29uc3RydWN0b3IsIG9wdHM6IFZ4ZVRhYmxlUHJvcFR5cGVzLkV4cG9ydENvbmZpZywgcm93czogYW55W10sIGNvbHVtbjogVnhlVGFibGVEZWZpbmVzLkNvbHVtbkluZm8pIHtcclxuICBjb25zdCBjZWxsVmFsdWUgPSBnZXRDZWxsTGFiZWwoY29sdW1uLCByb3dzWyR0YWJsZS5nZXRWTUNvbHVtbkluZGV4KGNvbHVtbildKVxyXG4gIHJldHVybiBjZWxsVmFsdWVcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0VmFsaWRDb2x1bW4gKGNvbHVtbjogVnhlVGFibGVEZWZpbmVzLkNvbHVtbkluZm8pOiBWeGVUYWJsZURlZmluZXMuQ29sdW1uSW5mbyB7XHJcbiAgY29uc3QgeyBjaGlsZE5vZGVzIH0gPSBjb2x1bW5cclxuICBjb25zdCBpc0NvbEdyb3VwID0gY2hpbGROb2RlcyAmJiBjaGlsZE5vZGVzLmxlbmd0aFxyXG4gIGlmIChpc0NvbEdyb3VwKSB7XHJcbiAgICByZXR1cm4gZ2V0VmFsaWRDb2x1bW4oY2hpbGROb2Rlc1swXSlcclxuICB9XHJcbiAgcmV0dXJuIGNvbHVtblxyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRFeGNlbFJvd0hlaWdodCAoZXhjZWxSb3c6IEV4Y2VsSlMuUm93LCBoZWlnaHQ6IG51bWJlcikge1xyXG4gIGlmIChoZWlnaHQpIHtcclxuICAgIGV4Y2VsUm93LmhlaWdodCA9IFhFVXRpbHMuZmxvb3IoaGVpZ2h0ICogMC43NSwgMTIpXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBzZXRFeGNlbENlbGxTdHlsZSAoZXhjZWxDZWxsOiBFeGNlbEpTLkNlbGwsIGFsaWduPzogVnhlVGFibGVQcm9wVHlwZXMuQWxpZ24gfCBWeGVUYWJsZVByb3BUeXBlcy5IZWFkZXJBbGlnbiB8IFZ4ZVRhYmxlUHJvcFR5cGVzLkZvb3RlckFsaWduKSB7XHJcbiAgZXhjZWxDZWxsLnByb3RlY3Rpb24gPSB7XHJcbiAgICBsb2NrZWQ6IGZhbHNlXHJcbiAgfVxyXG4gIGV4Y2VsQ2VsbC5hbGlnbm1lbnQgPSB7XHJcbiAgICB2ZXJ0aWNhbDogJ21pZGRsZScsXHJcbiAgICBob3Jpem9udGFsOiBhbGlnbiB8fCAnbGVmdCdcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldERlZmF1bHRCb3JkZXJTdHlsZSAoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHRvcDoge1xyXG4gICAgICBzdHlsZTogZGVmYXVsdENlbGxCb3JkZXJTdHlsZSxcclxuICAgICAgY29sb3I6IHtcclxuICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBsZWZ0OiB7XHJcbiAgICAgIHN0eWxlOiBkZWZhdWx0Q2VsbEJvcmRlclN0eWxlLFxyXG4gICAgICBjb2xvcjoge1xyXG4gICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3JcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIGJvdHRvbToge1xyXG4gICAgICBzdHlsZTogZGVmYXVsdENlbGxCb3JkZXJTdHlsZSxcclxuICAgICAgY29sb3I6IHtcclxuICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICByaWdodDoge1xyXG4gICAgICBzdHlsZTogZGVmYXVsdENlbGxCb3JkZXJTdHlsZSxcclxuICAgICAgY29sb3I6IHtcclxuICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGV4cG9ydFhMU1ggKHBhcmFtczogVnhlR2xvYmFsSW50ZXJjZXB0b3JIYW5kbGVzLkludGVyY2VwdG9yRXhwb3J0UGFyYW1zKSB7XHJcbiAgY29uc3QgbXNnS2V5ID0gJ3hsc3gnXHJcbiAgY29uc3QgeyBtb2RhbCwgdCB9ID0gdnhldGFibGVcclxuICBjb25zdCB7ICR0YWJsZSwgb3B0aW9ucywgY29sdW1ucywgY29sZ3JvdXBzLCBkYXRhcyB9ID0gcGFyYW1zXHJcbiAgY29uc3QgeyBwcm9wcywgcmVhY3REYXRhIH0gPSAkdGFibGVcclxuICBjb25zdCB7IGhlYWRlckFsaWduOiBhbGxIZWFkZXJBbGlnbiwgYWxpZ246IGFsbEFsaWduLCBmb290ZXJBbGlnbjogYWxsRm9vdGVyQWxpZ24gfSA9IHByb3BzXHJcbiAgY29uc3QgeyByb3dIZWlnaHQgfSA9IHJlYWN0RGF0YVxyXG4gIGNvbnN0IHsgbWVzc2FnZSwgc2hlZXROYW1lLCBpc0hlYWRlciwgaXNGb290ZXIsIGlzTWVyZ2UsIGlzQ29sZ3JvdXAsIG9yaWdpbmFsLCB1c2VTdHlsZSwgc2hlZXRNZXRob2QgfSA9IG9wdGlvbnNcclxuICBjb25zdCBzaG93TXNnID0gbWVzc2FnZSAhPT0gZmFsc2VcclxuICBjb25zdCBtZXJnZUNlbGxzID0gJHRhYmxlLmdldE1lcmdlQ2VsbHMoKVxyXG4gIGNvbnN0IGNvbExpc3Q6IGFueVtdID0gW11cclxuICBjb25zdCBmb290TGlzdDogYW55W10gPSBbXVxyXG4gIGNvbnN0IHNoZWV0Q29sczogYW55W10gPSBbXVxyXG4gIGNvbnN0IHNoZWV0TWVyZ2VzOiB7IHM6IHsgcjogbnVtYmVyLCBjOiBudW1iZXIgfSwgZTogeyByOiBudW1iZXIsIGM6IG51bWJlciB9IH1bXSA9IFtdXHJcbiAgbGV0IGJlZm9yZVJvd0NvdW50ID0gMFxyXG4gIGNvbnN0IGNvbEhlYWQ6IGFueSA9IHt9XHJcbiAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcclxuICAgIGNvbnN0IHsgaWQsIGZpZWxkLCByZW5kZXJXaWR0aCB9ID0gY29sdW1uXHJcbiAgICBjb2xIZWFkW2lkXSA9IG9yaWdpbmFsID8gZmllbGQgOiBjb2x1bW4uZ2V0VGl0bGUoKVxyXG4gICAgc2hlZXRDb2xzLnB1c2goe1xyXG4gICAgICBrZXk6IGlkLFxyXG4gICAgICB3aWR0aDogWEVVdGlscy5jZWlsKHJlbmRlcldpZHRoIC8gOCwgMSlcclxuICAgIH0pXHJcbiAgfSlcclxuICAvLyDlpITnkIbooajlpLRcclxuICBpZiAoaXNIZWFkZXIpIHtcclxuICAgIC8vIOWkhOeQhuWIhue7hFxyXG4gICAgaWYgKGlzQ29sZ3JvdXAgJiYgIW9yaWdpbmFsICYmIGNvbGdyb3Vwcykge1xyXG4gICAgICBjb2xncm91cHMuZm9yRWFjaCgoY29scywgckluZGV4KSA9PiB7XHJcbiAgICAgICAgY29uc3QgZ3JvdXBIZWFkOiBhbnkgPSB7fVxyXG4gICAgICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XHJcbiAgICAgICAgICBncm91cEhlYWRbY29sdW1uLmlkXSA9IG51bGxcclxuICAgICAgICB9KVxyXG4gICAgICAgIGNvbHMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCB7IF9jb2xTcGFuLCBfcm93U3BhbiB9ID0gY29sdW1uXHJcbiAgICAgICAgICBjb25zdCB2YWxpZENvbHVtbiA9IGdldFZhbGlkQ29sdW1uKGNvbHVtbilcclxuICAgICAgICAgIGNvbnN0IGNvbHVtbkluZGV4ID0gY29sdW1ucy5pbmRleE9mKHZhbGlkQ29sdW1uKVxyXG4gICAgICAgICAgZ3JvdXBIZWFkW3ZhbGlkQ29sdW1uLmlkXSA9IG9yaWdpbmFsID8gdmFsaWRDb2x1bW4uZmllbGQgOiBjb2x1bW4uZ2V0VGl0bGUoKVxyXG4gICAgICAgICAgaWYgKF9jb2xTcGFuID4gMSB8fCBfcm93U3BhbiA+IDEpIHtcclxuICAgICAgICAgICAgc2hlZXRNZXJnZXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgczogeyByOiBySW5kZXgsIGM6IGNvbHVtbkluZGV4IH0sXHJcbiAgICAgICAgICAgICAgZTogeyByOiBySW5kZXggKyBfcm93U3BhbiAtIDEsIGM6IGNvbHVtbkluZGV4ICsgX2NvbFNwYW4gLSAxIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIGNvbExpc3QucHVzaChncm91cEhlYWQpXHJcbiAgICAgIH0pXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb2xMaXN0LnB1c2goY29sSGVhZClcclxuICAgIH1cclxuICAgIGJlZm9yZVJvd0NvdW50ICs9IGNvbExpc3QubGVuZ3RoXHJcbiAgfVxyXG4gIC8vIOWkhOeQhuWQiOW5tlxyXG4gIGlmIChpc01lcmdlICYmICFvcmlnaW5hbCkge1xyXG4gICAgbWVyZ2VDZWxscy5mb3JFYWNoKG1lcmdlSXRlbSA9PiB7XHJcbiAgICAgIGNvbnN0IHsgcm93OiBtZXJnZVJvd0luZGV4LCByb3dzcGFuOiBtZXJnZVJvd3NwYW4sIGNvbDogbWVyZ2VDb2xJbmRleCwgY29sc3BhbjogbWVyZ2VDb2xzcGFuIH0gPSBtZXJnZUl0ZW1cclxuICAgICAgc2hlZXRNZXJnZXMucHVzaCh7XHJcbiAgICAgICAgczogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQsIGM6IG1lcmdlQ29sSW5kZXggfSxcclxuICAgICAgICBlOiB7IHI6IG1lcmdlUm93SW5kZXggKyBiZWZvcmVSb3dDb3VudCArIG1lcmdlUm93c3BhbiAtIDEsIGM6IG1lcmdlQ29sSW5kZXggKyBtZXJnZUNvbHNwYW4gLSAxIH1cclxuICAgICAgfSlcclxuICAgIH0pXHJcbiAgfVxyXG4gIGNvbnN0IHJvd0xpc3QgPSBkYXRhcy5tYXAoaXRlbSA9PiB7XHJcbiAgICBjb25zdCByZXN0OiBhbnkgPSB7fVxyXG4gICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcclxuICAgICAgcmVzdFtjb2x1bW4uaWRdID0gZ2V0Q2VsbExhYmVsKGNvbHVtbiwgaXRlbVtjb2x1bW4uaWRdKVxyXG4gICAgfSlcclxuICAgIHJldHVybiByZXN0XHJcbiAgfSlcclxuICBiZWZvcmVSb3dDb3VudCArPSByb3dMaXN0Lmxlbmd0aFxyXG4gIC8vIOWkhOeQhuihqOWwvlxyXG4gIGlmIChpc0Zvb3Rlcikge1xyXG4gICAgY29uc3QgeyBmb290ZXJEYXRhIH0gPSAkdGFibGUuZ2V0VGFibGVEYXRhKClcclxuICAgIGNvbnN0IGZvb3RlcnMgPSBnZXRGb290ZXJEYXRhKG9wdGlvbnMsIGZvb3RlckRhdGEpXHJcbiAgICBjb25zdCBtZXJnZUZvb3Rlckl0ZW1zID0gJHRhYmxlLmdldE1lcmdlRm9vdGVySXRlbXMoKVxyXG4gICAgLy8g5aSE55CG5ZCI5bm2XHJcbiAgICBpZiAoaXNNZXJnZSAmJiAhb3JpZ2luYWwpIHtcclxuICAgICAgbWVyZ2VGb290ZXJJdGVtcy5mb3JFYWNoKG1lcmdlSXRlbSA9PiB7XHJcbiAgICAgICAgY29uc3QgeyByb3c6IG1lcmdlUm93SW5kZXgsIHJvd3NwYW46IG1lcmdlUm93c3BhbiwgY29sOiBtZXJnZUNvbEluZGV4LCBjb2xzcGFuOiBtZXJnZUNvbHNwYW4gfSA9IG1lcmdlSXRlbVxyXG4gICAgICAgIHNoZWV0TWVyZ2VzLnB1c2goe1xyXG4gICAgICAgICAgczogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQsIGM6IG1lcmdlQ29sSW5kZXggfSxcclxuICAgICAgICAgIGU6IHsgcjogbWVyZ2VSb3dJbmRleCArIGJlZm9yZVJvd0NvdW50ICsgbWVyZ2VSb3dzcGFuIC0gMSwgYzogbWVyZ2VDb2xJbmRleCArIG1lcmdlQ29sc3BhbiAtIDEgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBmb290ZXJzLmZvckVhY2goKHJvd3MpID0+IHtcclxuICAgICAgY29uc3QgaXRlbTogYW55ID0ge31cclxuICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcclxuICAgICAgICBpdGVtW2NvbHVtbi5pZF0gPSBnZXRGb290ZXJDZWxsVmFsdWUoJHRhYmxlLCBvcHRpb25zLCByb3dzLCBjb2x1bW4pXHJcbiAgICAgIH0pXHJcbiAgICAgIGZvb3RMaXN0LnB1c2goaXRlbSlcclxuICAgIH0pXHJcbiAgfVxyXG4gIGNvbnN0IGV4cG9ydE1ldGhvZCA9ICgpID0+IHtcclxuICAgIGNvbnN0IHdvcmtib29rID0gbmV3IEV4Y2VsSlMuV29ya2Jvb2soKVxyXG4gICAgY29uc3Qgc2hlZXQgPSB3b3JrYm9vay5hZGRXb3Jrc2hlZXQoc2hlZXROYW1lKVxyXG4gICAgd29ya2Jvb2suY3JlYXRvciA9ICd2eGUtdGFibGUnXHJcbiAgICBzaGVldC5jb2x1bW5zID0gc2hlZXRDb2xzXHJcbiAgICBpZiAoaXNIZWFkZXIpIHtcclxuICAgICAgc2hlZXQuYWRkUm93cyhjb2xMaXN0KS5mb3JFYWNoKGV4Y2VsUm93ID0+IHtcclxuICAgICAgICBpZiAodXNlU3R5bGUpIHtcclxuICAgICAgICAgIHNldEV4Y2VsUm93SGVpZ2h0KGV4Y2VsUm93LCByb3dIZWlnaHQpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XHJcbiAgICAgICAgICBjb25zdCBleGNlbENvbCA9IHNoZWV0LmdldENvbHVtbihleGNlbENlbGwuY29sKVxyXG4gICAgICAgICAgY29uc3QgY29sdW1uOiBhbnkgPSAkdGFibGUuZ2V0Q29sdW1uQnlJZChleGNlbENvbC5rZXkgYXMgc3RyaW5nKVxyXG4gICAgICAgICAgY29uc3QgeyBoZWFkZXJBbGlnbiwgYWxpZ24gfSA9IGNvbHVtblxyXG4gICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBoZWFkZXJBbGlnbiB8fCBhbGlnbiB8fCBhbGxIZWFkZXJBbGlnbiB8fCBhbGxBbGlnbilcclxuICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xyXG4gICAgICAgICAgICAgIGZvbnQ6IHtcclxuICAgICAgICAgICAgICAgIGJvbGQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBjb2xvcjoge1xyXG4gICAgICAgICAgICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEZvbnRDb2xvclxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgZmlsbDoge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ3BhdHRlcm4nLFxyXG4gICAgICAgICAgICAgICAgcGF0dGVybjogJ3NvbGlkJyxcclxuICAgICAgICAgICAgICAgIGZnQ29sb3I6IHtcclxuICAgICAgICAgICAgICAgICAgYXJnYjogZGVmYXVsdEhlYWRlckJhY2tncm91bmRDb2xvclxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgYm9yZGVyOiBnZXREZWZhdWx0Qm9yZGVyU3R5bGUoKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBzaGVldC5hZGRSb3dzKHJvd0xpc3QpLmZvckVhY2goZXhjZWxSb3cgPT4ge1xyXG4gICAgICBpZiAodXNlU3R5bGUpIHtcclxuICAgICAgICBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgcm93SGVpZ2h0KVxyXG4gICAgICB9XHJcbiAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XHJcbiAgICAgICAgY29uc3QgZXhjZWxDb2wgPSBzaGVldC5nZXRDb2x1bW4oZXhjZWxDZWxsLmNvbClcclxuICAgICAgICBjb25zdCBjb2x1bW4gPSAkdGFibGUuZ2V0Q29sdW1uQnlJZChleGNlbENvbC5rZXkgYXMgc3RyaW5nKVxyXG4gICAgICAgIGlmIChjb2x1bW4pIHtcclxuICAgICAgICAgIGNvbnN0IHsgYWxpZ24gfSA9IGNvbHVtblxyXG4gICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBhbGlnbiB8fCBhbGxBbGlnbilcclxuICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xyXG4gICAgICAgICAgICAgIGZvbnQ6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yOiB7XHJcbiAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsRm9udENvbG9yXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBib3JkZXI6IGdldERlZmF1bHRCb3JkZXJTdHlsZSgpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuICAgIGlmIChpc0Zvb3Rlcikge1xyXG4gICAgICBzaGVldC5hZGRSb3dzKGZvb3RMaXN0KS5mb3JFYWNoKGV4Y2VsUm93ID0+IHtcclxuICAgICAgICBpZiAodXNlU3R5bGUpIHtcclxuICAgICAgICAgIHNldEV4Y2VsUm93SGVpZ2h0KGV4Y2VsUm93LCByb3dIZWlnaHQpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XHJcbiAgICAgICAgICBjb25zdCBleGNlbENvbCA9IHNoZWV0LmdldENvbHVtbihleGNlbENlbGwuY29sKVxyXG4gICAgICAgICAgY29uc3QgY29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5SWQoZXhjZWxDb2wua2V5IGFzIHN0cmluZylcclxuICAgICAgICAgIGlmIChjb2x1bW4pIHtcclxuICAgICAgICAgICAgY29uc3QgeyBmb290ZXJBbGlnbiwgYWxpZ24gfSA9IGNvbHVtblxyXG4gICAgICAgICAgICBzZXRFeGNlbENlbGxTdHlsZShleGNlbENlbGwsIGZvb3RlckFsaWduIHx8IGFsaWduIHx8IGFsbEZvb3RlckFsaWduIHx8IGFsbEFsaWduKVxyXG4gICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcclxuICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xyXG4gICAgICAgICAgICAgICAgZm9udDoge1xyXG4gICAgICAgICAgICAgICAgICBjb2xvcjoge1xyXG4gICAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsRm9udENvbG9yXHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBib3JkZXI6IGdldERlZmF1bHRCb3JkZXJTdHlsZSgpXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBpZiAodXNlU3R5bGUgJiYgc2hlZXRNZXRob2QpIHtcclxuICAgICAgc2hlZXRNZXRob2QoeyBvcHRpb25zOiBvcHRpb25zLCB3b3JrYm9vaywgd29ya3NoZWV0OiBzaGVldCwgY29sdW1ucywgY29sZ3JvdXBzLCBkYXRhcywgJHRhYmxlIH0pXHJcbiAgICB9XHJcbiAgICBzaGVldE1lcmdlcy5mb3JFYWNoKCh7IHMsIGUgfSkgPT4ge1xyXG4gICAgICBzaGVldC5tZXJnZUNlbGxzKHMuciArIDEsIHMuYyArIDEsIGUuciArIDEsIGUuYyArIDEpXHJcbiAgICB9KVxyXG4gICAgd29ya2Jvb2sueGxzeC53cml0ZUJ1ZmZlcigpLnRoZW4oYnVmZmVyID0+IHtcclxuICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtidWZmZXJdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nIH0pXHJcbiAgICAgIC8vIOWvvOWHuiB4bHN4XHJcbiAgICAgIGRvd25sb2FkRmlsZShwYXJhbXMsIGJsb2IsIG9wdGlvbnMpXHJcbiAgICAgIGlmIChzaG93TXNnICYmIG1vZGFsKSB7XHJcbiAgICAgICAgbW9kYWwuY2xvc2UobXNnS2V5KVxyXG4gICAgICAgIG1vZGFsLm1lc3NhZ2UoeyBjb250ZW50OiB0KCd2eGUudGFibGUuZXhwU3VjY2VzcycpLCBzdGF0dXM6ICdzdWNjZXNzJyB9KVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuICBpZiAoc2hvd01zZyAmJiBtb2RhbCkge1xyXG4gICAgbW9kYWwubWVzc2FnZSh7IGlkOiBtc2dLZXksIGNvbnRlbnQ6IHQoJ3Z4ZS50YWJsZS5leHBMb2FkaW5nJyksIHN0YXR1czogJ2xvYWRpbmcnLCBkdXJhdGlvbjogLTEgfSlcclxuICAgIHNldFRpbWVvdXQoZXhwb3J0TWV0aG9kLCAxNTAwKVxyXG4gIH0gZWxzZSB7XHJcbiAgICBleHBvcnRNZXRob2QoKVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZG93bmxvYWRGaWxlIChwYXJhbXM6IFZ4ZUdsb2JhbEludGVyY2VwdG9ySGFuZGxlcy5JbnRlcmNlcHRvckV4cG9ydFBhcmFtcywgYmxvYjogQmxvYiwgb3B0aW9uczogVnhlVGFibGVQcm9wVHlwZXMuRXhwb3J0Q29uZmlnKSB7XHJcbiAgY29uc3QgeyBtb2RhbCwgdCB9ID0gdnhldGFibGVcclxuICBjb25zdCB7IG1lc3NhZ2UsIGZpbGVuYW1lLCB0eXBlIH0gPSBvcHRpb25zXHJcbiAgY29uc3Qgc2hvd01zZyA9IG1lc3NhZ2UgIT09IGZhbHNlXHJcbiAgaWYgKHdpbmRvdy5CbG9iKSB7XHJcbiAgICBpZiAoKG5hdmlnYXRvciBhcyBhbnkpLm1zU2F2ZUJsb2IpIHtcclxuICAgICAgKG5hdmlnYXRvciBhcyBhbnkpLm1zU2F2ZUJsb2IoYmxvYiwgYCR7ZmlsZW5hbWV9LiR7dHlwZX1gKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgbGlua0VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJylcclxuICAgICAgbGlua0VsZW0udGFyZ2V0ID0gJ19ibGFuaydcclxuICAgICAgbGlua0VsZW0uZG93bmxvYWQgPSBgJHtmaWxlbmFtZX0uJHt0eXBlfWBcclxuICAgICAgbGlua0VsZW0uaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYilcclxuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rRWxlbSlcclxuICAgICAgbGlua0VsZW0uY2xpY2soKVxyXG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmtFbGVtKVxyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBpZiAoc2hvd01zZyAmJiBtb2RhbCkge1xyXG4gICAgICBtb2RhbC5hbGVydCh7IGNvbnRlbnQ6IHQoJ3Z4ZS5lcnJvci5ub3RFeHAnKSwgc3RhdHVzOiAnZXJyb3InIH0pXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjaGVja0ltcG9ydERhdGEgKHRhYmxlRmllbGRzOiBzdHJpbmdbXSwgZmllbGRzOiBzdHJpbmdbXSkge1xyXG4gIHJldHVybiBmaWVsZHMuc29tZShmaWVsZCA9PiB0YWJsZUZpZWxkcy5pbmRleE9mKGZpZWxkKSA+IC0xKVxyXG59XHJcblxyXG5mdW5jdGlvbiBpbXBvcnRFcnJvciAocGFyYW1zOiBWeGVHbG9iYWxJbnRlcmNlcHRvckhhbmRsZXMuSW50ZXJjZXB0b3JJbXBvcnRQYXJhbXMpIHtcclxuICBjb25zdCB7IG1vZGFsLCB0IH0gPSB2eGV0YWJsZVxyXG4gIGNvbnN0IHsgJHRhYmxlLCBvcHRpb25zIH0gPSBwYXJhbXNcclxuICBjb25zdCB7IGludGVybmFsRGF0YSB9ID0gJHRhYmxlXHJcbiAgY29uc3QgeyBfaW1wb3J0UmVqZWN0IH0gPSBpbnRlcm5hbERhdGFcclxuICBjb25zdCBzaG93TXNnID0gb3B0aW9ucy5tZXNzYWdlICE9PSBmYWxzZVxyXG4gIGlmIChzaG93TXNnICYmIG1vZGFsKSB7XHJcbiAgICBtb2RhbC5tZXNzYWdlKHsgY29udGVudDogdCgndnhlLmVycm9yLmltcEZpZWxkcycpLCBzdGF0dXM6ICdlcnJvcicgfSlcclxuICB9XHJcbiAgaWYgKF9pbXBvcnRSZWplY3QpIHtcclxuICAgIF9pbXBvcnRSZWplY3QoeyBzdGF0dXM6IGZhbHNlIH0pXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBpbXBvcnRYTFNYIChwYXJhbXM6IFZ4ZUdsb2JhbEludGVyY2VwdG9ySGFuZGxlcy5JbnRlcmNlcHRvckltcG9ydFBhcmFtcykge1xyXG4gIGNvbnN0IHsgbW9kYWwsIHQgfSA9IHZ4ZXRhYmxlXHJcbiAgY29uc3QgeyAkdGFibGUsIGNvbHVtbnMsIG9wdGlvbnMsIGZpbGUgfSA9IHBhcmFtc1xyXG4gIGNvbnN0IHsgaW50ZXJuYWxEYXRhIH0gPSAkdGFibGVcclxuICBjb25zdCB7IF9pbXBvcnRSZXNvbHZlIH0gPSBpbnRlcm5hbERhdGFcclxuICBjb25zdCBzaG93TXNnID0gb3B0aW9ucy5tZXNzYWdlICE9PSBmYWxzZVxyXG4gIGNvbnN0IGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpXHJcbiAgZmlsZVJlYWRlci5vbmVycm9yID0gKCkgPT4ge1xyXG4gICAgaW1wb3J0RXJyb3IocGFyYW1zKVxyXG4gIH1cclxuICBmaWxlUmVhZGVyLm9ubG9hZCA9IChldm50KSA9PiB7XHJcbiAgICBjb25zdCB0YWJsZUZpZWxkczogc3RyaW5nW10gPSBbXVxyXG4gICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcclxuICAgICAgY29uc3QgZmllbGQgPSBjb2x1bW4uZmllbGRcclxuICAgICAgaWYgKGZpZWxkKSB7XHJcbiAgICAgICAgdGFibGVGaWVsZHMucHVzaChmaWVsZClcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIGNvbnN0IHdvcmtib29rID0gbmV3IEV4Y2VsSlMuV29ya2Jvb2soKVxyXG4gICAgY29uc3QgcmVhZGVyVGFyZ2V0ID0gZXZudC50YXJnZXRcclxuICAgIGlmIChyZWFkZXJUYXJnZXQpIHtcclxuICAgICAgd29ya2Jvb2sueGxzeC5sb2FkKHJlYWRlclRhcmdldC5yZXN1bHQgYXMgQXJyYXlCdWZmZXIpLnRoZW4od2IgPT4ge1xyXG4gICAgICAgIGNvbnN0IGZpcnN0U2hlZXQgPSB3Yi53b3Jrc2hlZXRzWzBdXHJcbiAgICAgICAgaWYgKGZpcnN0U2hlZXQpIHtcclxuICAgICAgICAgIGNvbnN0IHNoZWV0VmFsdWVzID0gZmlyc3RTaGVldC5nZXRTaGVldFZhbHVlcygpIGFzIHN0cmluZ1tdW11cclxuICAgICAgICAgIGNvbnN0IGZpZWxkSW5kZXggPSBYRVV0aWxzLmZpbmRJbmRleE9mKHNoZWV0VmFsdWVzLCAobGlzdCkgPT4gbGlzdCAmJiBsaXN0Lmxlbmd0aCA+IDApXHJcbiAgICAgICAgICBjb25zdCBmaWVsZHMgPSBzaGVldFZhbHVlc1tmaWVsZEluZGV4XSBhcyBzdHJpbmdbXVxyXG4gICAgICAgICAgY29uc3Qgc3RhdHVzID0gY2hlY2tJbXBvcnREYXRhKHRhYmxlRmllbGRzLCBmaWVsZHMpXHJcbiAgICAgICAgICBpZiAoc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlY29yZHMgPSBzaGVldFZhbHVlcy5zbGljZShmaWVsZEluZGV4KS5tYXAobGlzdCA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgaXRlbSA6IGFueSA9IHt9XHJcbiAgICAgICAgICAgICAgbGlzdC5mb3JFYWNoKChjZWxsVmFsdWUsIGNJbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaXRlbVtmaWVsZHNbY0luZGV4XV0gPSBjZWxsVmFsdWVcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIGNvbnN0IHJlY29yZDogYW55ID0ge31cclxuICAgICAgICAgICAgICB0YWJsZUZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcclxuICAgICAgICAgICAgICAgIHJlY29yZFtmaWVsZF0gPSBYRVV0aWxzLmlzVW5kZWZpbmVkKGl0ZW1bZmllbGRdKSA/IG51bGwgOiBpdGVtW2ZpZWxkXVxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAkdGFibGUuY3JlYXRlRGF0YShyZWNvcmRzKVxyXG4gICAgICAgICAgICAgIC50aGVuKChkYXRhOiBhbnlbXSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGxvYWRSZXN0OiBQcm9taXNlPGFueT5cclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1vZGUgPT09ICdpbnNlcnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgIGxvYWRSZXN0ID0gJHRhYmxlLmluc2VydEF0KGRhdGEsIC0xKVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgbG9hZFJlc3QgPSAkdGFibGUucmVsb2FkRGF0YShkYXRhKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxvYWRSZXN0LnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICBpZiAoX2ltcG9ydFJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBfaW1wb3J0UmVzb2x2ZSh7IHN0YXR1czogdHJ1ZSB9KVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIGlmIChzaG93TXNnICYmIG1vZGFsKSB7XHJcbiAgICAgICAgICAgICAgbW9kYWwubWVzc2FnZSh7IGNvbnRlbnQ6IHQoJ3Z4ZS50YWJsZS5pbXBTdWNjZXNzJywgW3JlY29yZHMubGVuZ3RoXSksIHN0YXR1czogJ3N1Y2Nlc3MnIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGltcG9ydEVycm9yKHBhcmFtcylcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaW1wb3J0RXJyb3IocGFyYW1zKVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGltcG9ydEVycm9yKHBhcmFtcylcclxuICAgIH1cclxuICB9XHJcbiAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVJbXBvcnRFdmVudCAocGFyYW1zOiBWeGVHbG9iYWxJbnRlcmNlcHRvckhhbmRsZXMuSW50ZXJjZXB0b3JJbXBvcnRQYXJhbXMpIHtcclxuICBpZiAocGFyYW1zLm9wdGlvbnMudHlwZSA9PT0gJ3hsc3gnKSB7XHJcbiAgICBpbXBvcnRYTFNYKHBhcmFtcylcclxuICAgIHJldHVybiBmYWxzZVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRXhwb3J0RXZlbnQgKHBhcmFtczogVnhlR2xvYmFsSW50ZXJjZXB0b3JIYW5kbGVzLkludGVyY2VwdG9yRXhwb3J0UGFyYW1zKSB7XHJcbiAgaWYgKHBhcmFtcy5vcHRpb25zLnR5cGUgPT09ICd4bHN4Jykge1xyXG4gICAgZXhwb3J0WExTWChwYXJhbXMpXHJcbiAgICByZXR1cm4gZmFsc2VcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDln7rkuo4gdnhlLXRhYmxlIOihqOagvOeahOWinuW8uuaPkuS7tu+8jOaUr+aMgeWvvOWHuiB4bHN4IOagvOW8j1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IFZYRVRhYmxlUGx1Z2luRXhwb3J0WExTWCA9IHtcclxuICBpbnN0YWxsICh2eGV0YWJsZWNvcmU6IFZYRVRhYmxlQ29yZSkge1xyXG4gICAgY29uc3QgeyBzZXR1cCwgaW50ZXJjZXB0b3IgfSA9IHZ4ZXRhYmxlY29yZVxyXG5cclxuICAgIHZ4ZXRhYmxlID0gdnhldGFibGVjb3JlXHJcblxyXG4gICAgc2V0dXAoe1xyXG4gICAgICBleHBvcnQ6IHtcclxuICAgICAgICB0eXBlczoge1xyXG4gICAgICAgICAgeGxzeDogMFxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIGludGVyY2VwdG9yLm1peGluKHtcclxuICAgICAgJ2V2ZW50LmltcG9ydCc6IGhhbmRsZUltcG9ydEV2ZW50LFxyXG4gICAgICAnZXZlbnQuZXhwb3J0JzogaGFuZGxlRXhwb3J0RXZlbnRcclxuICAgIH0pXHJcbiAgfVxyXG59XHJcblxyXG5pZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LlZYRVRhYmxlICYmIHdpbmRvdy5WWEVUYWJsZS51c2UpIHtcclxuICB3aW5kb3cuVlhFVGFibGUudXNlKFZYRVRhYmxlUGx1Z2luRXhwb3J0WExTWClcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVlhFVGFibGVQbHVnaW5FeHBvcnRYTFNYXHJcbiIsImltcG9ydCBYRVV0aWxzIGZyb20gJ3hlLXV0aWxzJztcbmltcG9ydCBFeGNlbEpTIGZyb20gJ2V4Y2VsanMnO1xubGV0IHZ4ZXRhYmxlO1xuY29uc3QgZGVmYXVsdEhlYWRlckJhY2tncm91bmRDb2xvciA9ICdmOGY4ZjknO1xuY29uc3QgZGVmYXVsdENlbGxGb250Q29sb3IgPSAnNjA2MjY2JztcbmNvbnN0IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUgPSAndGhpbic7XG5jb25zdCBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yID0gJ2U4ZWFlYyc7XG5mdW5jdGlvbiBnZXRDZWxsTGFiZWwoY29sdW1uLCBjZWxsVmFsdWUpIHtcbiAgICBpZiAoY2VsbFZhbHVlKSB7XG4gICAgICAgIGlmIChjb2x1bW4udHlwZSA9PT0gJ3NlcScpIHtcbiAgICAgICAgICAgIHJldHVybiBYRVV0aWxzLnRvVmFsdWVTdHJpbmcoY2VsbFZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKGNvbHVtbi5jZWxsVHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gWEVVdGlscy50b1ZhbHVlU3RyaW5nKGNlbGxWYWx1ZSk7XG4gICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGlmICghaXNOYU4oY2VsbFZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVyKGNlbGxWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAoY2VsbFZhbHVlLmxlbmd0aCA8IDEyICYmICFpc05hTihjZWxsVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXIoY2VsbFZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNlbGxWYWx1ZTtcbn1cbmZ1bmN0aW9uIGdldEZvb3RlckRhdGEob3B0cywgZm9vdGVyRGF0YSkge1xuICAgIGNvbnN0IHsgZm9vdGVyRmlsdGVyTWV0aG9kIH0gPSBvcHRzO1xuICAgIHJldHVybiBmb290ZXJGaWx0ZXJNZXRob2QgPyBmb290ZXJEYXRhLmZpbHRlcigoaXRlbXMsIGluZGV4KSA9PiBmb290ZXJGaWx0ZXJNZXRob2QoeyBpdGVtcywgJHJvd0luZGV4OiBpbmRleCB9KSkgOiBmb290ZXJEYXRhO1xufVxuZnVuY3Rpb24gZ2V0Rm9vdGVyQ2VsbFZhbHVlKCR0YWJsZSwgb3B0cywgcm93cywgY29sdW1uKSB7XG4gICAgY29uc3QgY2VsbFZhbHVlID0gZ2V0Q2VsbExhYmVsKGNvbHVtbiwgcm93c1skdGFibGUuZ2V0Vk1Db2x1bW5JbmRleChjb2x1bW4pXSk7XG4gICAgcmV0dXJuIGNlbGxWYWx1ZTtcbn1cbmZ1bmN0aW9uIGdldFZhbGlkQ29sdW1uKGNvbHVtbikge1xuICAgIGNvbnN0IHsgY2hpbGROb2RlcyB9ID0gY29sdW1uO1xuICAgIGNvbnN0IGlzQ29sR3JvdXAgPSBjaGlsZE5vZGVzICYmIGNoaWxkTm9kZXMubGVuZ3RoO1xuICAgIGlmIChpc0NvbEdyb3VwKSB7XG4gICAgICAgIHJldHVybiBnZXRWYWxpZENvbHVtbihjaGlsZE5vZGVzWzBdKTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbHVtbjtcbn1cbmZ1bmN0aW9uIHNldEV4Y2VsUm93SGVpZ2h0KGV4Y2VsUm93LCBoZWlnaHQpIHtcbiAgICBpZiAoaGVpZ2h0KSB7XG4gICAgICAgIGV4Y2VsUm93LmhlaWdodCA9IFhFVXRpbHMuZmxvb3IoaGVpZ2h0ICogMC43NSwgMTIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHNldEV4Y2VsQ2VsbFN0eWxlKGV4Y2VsQ2VsbCwgYWxpZ24pIHtcbiAgICBleGNlbENlbGwucHJvdGVjdGlvbiA9IHtcbiAgICAgICAgbG9ja2VkOiBmYWxzZVxuICAgIH07XG4gICAgZXhjZWxDZWxsLmFsaWdubWVudCA9IHtcbiAgICAgICAgdmVydGljYWw6ICdtaWRkbGUnLFxuICAgICAgICBob3Jpem9udGFsOiBhbGlnbiB8fCAnbGVmdCdcbiAgICB9O1xufVxuZnVuY3Rpb24gZ2V0RGVmYXVsdEJvcmRlclN0eWxlKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHRvcDoge1xuICAgICAgICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXG4gICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgbGVmdDoge1xuICAgICAgICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXG4gICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgYm90dG9tOiB7XG4gICAgICAgICAgICBzdHlsZTogZGVmYXVsdENlbGxCb3JkZXJTdHlsZSxcbiAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICAgICAgYXJnYjogZGVmYXVsdENlbGxCb3JkZXJDb2xvclxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByaWdodDoge1xuICAgICAgICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXG4gICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG59XG5mdW5jdGlvbiBleHBvcnRYTFNYKHBhcmFtcykge1xuICAgIGNvbnN0IG1zZ0tleSA9ICd4bHN4JztcbiAgICBjb25zdCB7IG1vZGFsLCB0IH0gPSB2eGV0YWJsZTtcbiAgICBjb25zdCB7ICR0YWJsZSwgb3B0aW9ucywgY29sdW1ucywgY29sZ3JvdXBzLCBkYXRhcyB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHsgcHJvcHMsIHJlYWN0RGF0YSB9ID0gJHRhYmxlO1xuICAgIGNvbnN0IHsgaGVhZGVyQWxpZ246IGFsbEhlYWRlckFsaWduLCBhbGlnbjogYWxsQWxpZ24sIGZvb3RlckFsaWduOiBhbGxGb290ZXJBbGlnbiB9ID0gcHJvcHM7XG4gICAgY29uc3QgeyByb3dIZWlnaHQgfSA9IHJlYWN0RGF0YTtcbiAgICBjb25zdCB7IG1lc3NhZ2UsIHNoZWV0TmFtZSwgaXNIZWFkZXIsIGlzRm9vdGVyLCBpc01lcmdlLCBpc0NvbGdyb3VwLCBvcmlnaW5hbCwgdXNlU3R5bGUsIHNoZWV0TWV0aG9kIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IHNob3dNc2cgPSBtZXNzYWdlICE9PSBmYWxzZTtcbiAgICBjb25zdCBtZXJnZUNlbGxzID0gJHRhYmxlLmdldE1lcmdlQ2VsbHMoKTtcbiAgICBjb25zdCBjb2xMaXN0ID0gW107XG4gICAgY29uc3QgZm9vdExpc3QgPSBbXTtcbiAgICBjb25zdCBzaGVldENvbHMgPSBbXTtcbiAgICBjb25zdCBzaGVldE1lcmdlcyA9IFtdO1xuICAgIGxldCBiZWZvcmVSb3dDb3VudCA9IDA7XG4gICAgY29uc3QgY29sSGVhZCA9IHt9O1xuICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaWQsIGZpZWxkLCByZW5kZXJXaWR0aCB9ID0gY29sdW1uO1xuICAgICAgICBjb2xIZWFkW2lkXSA9IG9yaWdpbmFsID8gZmllbGQgOiBjb2x1bW4uZ2V0VGl0bGUoKTtcbiAgICAgICAgc2hlZXRDb2xzLnB1c2goe1xuICAgICAgICAgICAga2V5OiBpZCxcbiAgICAgICAgICAgIHdpZHRoOiBYRVV0aWxzLmNlaWwocmVuZGVyV2lkdGggLyA4LCAxKVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICAvLyDlpITnkIbooajlpLRcbiAgICBpZiAoaXNIZWFkZXIpIHtcbiAgICAgICAgLy8g5aSE55CG5YiG57uEXG4gICAgICAgIGlmIChpc0NvbGdyb3VwICYmICFvcmlnaW5hbCAmJiBjb2xncm91cHMpIHtcbiAgICAgICAgICAgIGNvbGdyb3Vwcy5mb3JFYWNoKChjb2xzLCBySW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBncm91cEhlYWQgPSB7fTtcbiAgICAgICAgICAgICAgICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBncm91cEhlYWRbY29sdW1uLmlkXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29scy5mb3JFYWNoKChjb2x1bW4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBfY29sU3BhbiwgX3Jvd1NwYW4gfSA9IGNvbHVtbjtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsaWRDb2x1bW4gPSBnZXRWYWxpZENvbHVtbihjb2x1bW4pO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW5JbmRleCA9IGNvbHVtbnMuaW5kZXhPZih2YWxpZENvbHVtbik7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwSGVhZFt2YWxpZENvbHVtbi5pZF0gPSBvcmlnaW5hbCA/IHZhbGlkQ29sdW1uLmZpZWxkIDogY29sdW1uLmdldFRpdGxlKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfY29sU3BhbiA+IDEgfHwgX3Jvd1NwYW4gPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaGVldE1lcmdlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzOiB7IHI6IHJJbmRleCwgYzogY29sdW1uSW5kZXggfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlOiB7IHI6IHJJbmRleCArIF9yb3dTcGFuIC0gMSwgYzogY29sdW1uSW5kZXggKyBfY29sU3BhbiAtIDEgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb2xMaXN0LnB1c2goZ3JvdXBIZWFkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29sTGlzdC5wdXNoKGNvbEhlYWQpO1xuICAgICAgICB9XG4gICAgICAgIGJlZm9yZVJvd0NvdW50ICs9IGNvbExpc3QubGVuZ3RoO1xuICAgIH1cbiAgICAvLyDlpITnkIblkIjlubZcbiAgICBpZiAoaXNNZXJnZSAmJiAhb3JpZ2luYWwpIHtcbiAgICAgICAgbWVyZ2VDZWxscy5mb3JFYWNoKG1lcmdlSXRlbSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHJvdzogbWVyZ2VSb3dJbmRleCwgcm93c3BhbjogbWVyZ2VSb3dzcGFuLCBjb2w6IG1lcmdlQ29sSW5kZXgsIGNvbHNwYW46IG1lcmdlQ29sc3BhbiB9ID0gbWVyZ2VJdGVtO1xuICAgICAgICAgICAgc2hlZXRNZXJnZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgczogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQsIGM6IG1lcmdlQ29sSW5kZXggfSxcbiAgICAgICAgICAgICAgICBlOiB7IHI6IG1lcmdlUm93SW5kZXggKyBiZWZvcmVSb3dDb3VudCArIG1lcmdlUm93c3BhbiAtIDEsIGM6IG1lcmdlQ29sSW5kZXggKyBtZXJnZUNvbHNwYW4gLSAxIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3Qgcm93TGlzdCA9IGRhdGFzLm1hcChpdGVtID0+IHtcbiAgICAgICAgY29uc3QgcmVzdCA9IHt9O1xuICAgICAgICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgICAgICAgICAgcmVzdFtjb2x1bW4uaWRdID0gZ2V0Q2VsbExhYmVsKGNvbHVtbiwgaXRlbVtjb2x1bW4uaWRdKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN0O1xuICAgIH0pO1xuICAgIGJlZm9yZVJvd0NvdW50ICs9IHJvd0xpc3QubGVuZ3RoO1xuICAgIC8vIOWkhOeQhuihqOWwvlxuICAgIGlmIChpc0Zvb3Rlcikge1xuICAgICAgICBjb25zdCB7IGZvb3RlckRhdGEgfSA9ICR0YWJsZS5nZXRUYWJsZURhdGEoKTtcbiAgICAgICAgY29uc3QgZm9vdGVycyA9IGdldEZvb3RlckRhdGEob3B0aW9ucywgZm9vdGVyRGF0YSk7XG4gICAgICAgIGNvbnN0IG1lcmdlRm9vdGVySXRlbXMgPSAkdGFibGUuZ2V0TWVyZ2VGb290ZXJJdGVtcygpO1xuICAgICAgICAvLyDlpITnkIblkIjlubZcbiAgICAgICAgaWYgKGlzTWVyZ2UgJiYgIW9yaWdpbmFsKSB7XG4gICAgICAgICAgICBtZXJnZUZvb3Rlckl0ZW1zLmZvckVhY2gobWVyZ2VJdGVtID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IHJvdzogbWVyZ2VSb3dJbmRleCwgcm93c3BhbjogbWVyZ2VSb3dzcGFuLCBjb2w6IG1lcmdlQ29sSW5kZXgsIGNvbHNwYW46IG1lcmdlQ29sc3BhbiB9ID0gbWVyZ2VJdGVtO1xuICAgICAgICAgICAgICAgIHNoZWV0TWVyZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzOiB7IHI6IG1lcmdlUm93SW5kZXggKyBiZWZvcmVSb3dDb3VudCwgYzogbWVyZ2VDb2xJbmRleCB9LFxuICAgICAgICAgICAgICAgICAgICBlOiB7IHI6IG1lcmdlUm93SW5kZXggKyBiZWZvcmVSb3dDb3VudCArIG1lcmdlUm93c3BhbiAtIDEsIGM6IG1lcmdlQ29sSW5kZXggKyBtZXJnZUNvbHNwYW4gLSAxIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGZvb3RlcnMuZm9yRWFjaCgocm93cykgPT4ge1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IHt9O1xuICAgICAgICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcbiAgICAgICAgICAgICAgICBpdGVtW2NvbHVtbi5pZF0gPSBnZXRGb290ZXJDZWxsVmFsdWUoJHRhYmxlLCBvcHRpb25zLCByb3dzLCBjb2x1bW4pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb290TGlzdC5wdXNoKGl0ZW0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgZXhwb3J0TWV0aG9kID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB3b3JrYm9vayA9IG5ldyBFeGNlbEpTLldvcmtib29rKCk7XG4gICAgICAgIGNvbnN0IHNoZWV0ID0gd29ya2Jvb2suYWRkV29ya3NoZWV0KHNoZWV0TmFtZSk7XG4gICAgICAgIHdvcmtib29rLmNyZWF0b3IgPSAndnhlLXRhYmxlJztcbiAgICAgICAgc2hlZXQuY29sdW1ucyA9IHNoZWV0Q29scztcbiAgICAgICAgaWYgKGlzSGVhZGVyKSB7XG4gICAgICAgICAgICBzaGVldC5hZGRSb3dzKGNvbExpc3QpLmZvckVhY2goZXhjZWxSb3cgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xuICAgICAgICAgICAgICAgICAgICBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgcm93SGVpZ2h0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZXhjZWxSb3cuZWFjaENlbGwoZXhjZWxDZWxsID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhjZWxDb2wgPSBzaGVldC5nZXRDb2x1bW4oZXhjZWxDZWxsLmNvbCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbHVtbiA9ICR0YWJsZS5nZXRDb2x1bW5CeUlkKGV4Y2VsQ29sLmtleSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgaGVhZGVyQWxpZ24sIGFsaWduIH0gPSBjb2x1bW47XG4gICAgICAgICAgICAgICAgICAgIHNldEV4Y2VsQ2VsbFN0eWxlKGV4Y2VsQ2VsbCwgaGVhZGVyQWxpZ24gfHwgYWxpZ24gfHwgYWxsSGVhZGVyQWxpZ24gfHwgYWxsQWxpZ24pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZXhjZWxDZWxsLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2xkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnYjogZGVmYXVsdENlbGxGb250Q29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncGF0dGVybicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm46ICdzb2xpZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZnQ29sb3I6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRIZWFkZXJCYWNrZ3JvdW5kQ29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiBnZXREZWZhdWx0Qm9yZGVyU3R5bGUoKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHNoZWV0LmFkZFJvd3Mocm93TGlzdCkuZm9yRWFjaChleGNlbFJvdyA9PiB7XG4gICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgICAgICBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgcm93SGVpZ2h0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXhjZWxDb2wgPSBzaGVldC5nZXRDb2x1bW4oZXhjZWxDZWxsLmNvbCk7XG4gICAgICAgICAgICAgICAgY29uc3QgY29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5SWQoZXhjZWxDb2wua2V5KTtcbiAgICAgICAgICAgICAgICBpZiAoY29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgYWxpZ24gfSA9IGNvbHVtbjtcbiAgICAgICAgICAgICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBhbGlnbiB8fCBhbGxBbGlnbik7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihleGNlbENlbGwsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEZvbnRDb2xvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6IGdldERlZmF1bHRCb3JkZXJTdHlsZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGlzRm9vdGVyKSB7XG4gICAgICAgICAgICBzaGVldC5hZGRSb3dzKGZvb3RMaXN0KS5mb3JFYWNoKGV4Y2VsUm93ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0RXhjZWxSb3dIZWlnaHQoZXhjZWxSb3csIHJvd0hlaWdodCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4Y2VsQ29sID0gc2hlZXQuZ2V0Q29sdW1uKGV4Y2VsQ2VsbC5jb2wpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW4gPSAkdGFibGUuZ2V0Q29sdW1uQnlJZChleGNlbENvbC5rZXkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGZvb3RlckFsaWduLCBhbGlnbiB9ID0gY29sdW1uO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBmb290ZXJBbGlnbiB8fCBhbGlnbiB8fCBhbGxGb290ZXJBbGlnbiB8fCBhbGxBbGlnbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsRm9udENvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjogZ2V0RGVmYXVsdEJvcmRlclN0eWxlKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVzZVN0eWxlICYmIHNoZWV0TWV0aG9kKSB7XG4gICAgICAgICAgICBzaGVldE1ldGhvZCh7IG9wdGlvbnM6IG9wdGlvbnMsIHdvcmtib29rLCB3b3Jrc2hlZXQ6IHNoZWV0LCBjb2x1bW5zLCBjb2xncm91cHMsIGRhdGFzLCAkdGFibGUgfSk7XG4gICAgICAgIH1cbiAgICAgICAgc2hlZXRNZXJnZXMuZm9yRWFjaCgoeyBzLCBlIH0pID0+IHtcbiAgICAgICAgICAgIHNoZWV0Lm1lcmdlQ2VsbHMocy5yICsgMSwgcy5jICsgMSwgZS5yICsgMSwgZS5jICsgMSk7XG4gICAgICAgIH0pO1xuICAgICAgICB3b3JrYm9vay54bHN4LndyaXRlQnVmZmVyKCkudGhlbihidWZmZXIgPT4ge1xuICAgICAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtidWZmZXJdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nIH0pO1xuICAgICAgICAgICAgLy8g5a+85Ye6IHhsc3hcbiAgICAgICAgICAgIGRvd25sb2FkRmlsZShwYXJhbXMsIGJsb2IsIG9wdGlvbnMpO1xuICAgICAgICAgICAgaWYgKHNob3dNc2cgJiYgbW9kYWwpIHtcbiAgICAgICAgICAgICAgICBtb2RhbC5jbG9zZShtc2dLZXkpO1xuICAgICAgICAgICAgICAgIG1vZGFsLm1lc3NhZ2UoeyBjb250ZW50OiB0KCd2eGUudGFibGUuZXhwU3VjY2VzcycpLCBzdGF0dXM6ICdzdWNjZXNzJyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBpZiAoc2hvd01zZyAmJiBtb2RhbCkge1xuICAgICAgICBtb2RhbC5tZXNzYWdlKHsgaWQ6IG1zZ0tleSwgY29udGVudDogdCgndnhlLnRhYmxlLmV4cExvYWRpbmcnKSwgc3RhdHVzOiAnbG9hZGluZycsIGR1cmF0aW9uOiAtMSB9KTtcbiAgICAgICAgc2V0VGltZW91dChleHBvcnRNZXRob2QsIDE1MDApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZXhwb3J0TWV0aG9kKCk7XG4gICAgfVxufVxuZnVuY3Rpb24gZG93bmxvYWRGaWxlKHBhcmFtcywgYmxvYiwgb3B0aW9ucykge1xuICAgIGNvbnN0IHsgbW9kYWwsIHQgfSA9IHZ4ZXRhYmxlO1xuICAgIGNvbnN0IHsgbWVzc2FnZSwgZmlsZW5hbWUsIHR5cGUgfSA9IG9wdGlvbnM7XG4gICAgY29uc3Qgc2hvd01zZyA9IG1lc3NhZ2UgIT09IGZhbHNlO1xuICAgIGlmICh3aW5kb3cuQmxvYikge1xuICAgICAgICBpZiAobmF2aWdhdG9yLm1zU2F2ZUJsb2IpIHtcbiAgICAgICAgICAgIG5hdmlnYXRvci5tc1NhdmVCbG9iKGJsb2IsIGAke2ZpbGVuYW1lfS4ke3R5cGV9YCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBsaW5rRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgICAgICAgIGxpbmtFbGVtLnRhcmdldCA9ICdfYmxhbmsnO1xuICAgICAgICAgICAgbGlua0VsZW0uZG93bmxvYWQgPSBgJHtmaWxlbmFtZX0uJHt0eXBlfWA7XG4gICAgICAgICAgICBsaW5rRWxlbS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGlua0VsZW0pO1xuICAgICAgICAgICAgbGlua0VsZW0uY2xpY2soKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGlua0VsZW0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoc2hvd01zZyAmJiBtb2RhbCkge1xuICAgICAgICAgICAgbW9kYWwuYWxlcnQoeyBjb250ZW50OiB0KCd2eGUuZXJyb3Iubm90RXhwJyksIHN0YXR1czogJ2Vycm9yJyB9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGNoZWNrSW1wb3J0RGF0YSh0YWJsZUZpZWxkcywgZmllbGRzKSB7XG4gICAgcmV0dXJuIGZpZWxkcy5zb21lKGZpZWxkID0+IHRhYmxlRmllbGRzLmluZGV4T2YoZmllbGQpID4gLTEpO1xufVxuZnVuY3Rpb24gaW1wb3J0RXJyb3IocGFyYW1zKSB7XG4gICAgY29uc3QgeyBtb2RhbCwgdCB9ID0gdnhldGFibGU7XG4gICAgY29uc3QgeyAkdGFibGUsIG9wdGlvbnMgfSA9IHBhcmFtcztcbiAgICBjb25zdCB7IGludGVybmFsRGF0YSB9ID0gJHRhYmxlO1xuICAgIGNvbnN0IHsgX2ltcG9ydFJlamVjdCB9ID0gaW50ZXJuYWxEYXRhO1xuICAgIGNvbnN0IHNob3dNc2cgPSBvcHRpb25zLm1lc3NhZ2UgIT09IGZhbHNlO1xuICAgIGlmIChzaG93TXNnICYmIG1vZGFsKSB7XG4gICAgICAgIG1vZGFsLm1lc3NhZ2UoeyBjb250ZW50OiB0KCd2eGUuZXJyb3IuaW1wRmllbGRzJyksIHN0YXR1czogJ2Vycm9yJyB9KTtcbiAgICB9XG4gICAgaWYgKF9pbXBvcnRSZWplY3QpIHtcbiAgICAgICAgX2ltcG9ydFJlamVjdCh7IHN0YXR1czogZmFsc2UgfSk7XG4gICAgfVxufVxuZnVuY3Rpb24gaW1wb3J0WExTWChwYXJhbXMpIHtcbiAgICBjb25zdCB7IG1vZGFsLCB0IH0gPSB2eGV0YWJsZTtcbiAgICBjb25zdCB7ICR0YWJsZSwgY29sdW1ucywgb3B0aW9ucywgZmlsZSB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHsgaW50ZXJuYWxEYXRhIH0gPSAkdGFibGU7XG4gICAgY29uc3QgeyBfaW1wb3J0UmVzb2x2ZSB9ID0gaW50ZXJuYWxEYXRhO1xuICAgIGNvbnN0IHNob3dNc2cgPSBvcHRpb25zLm1lc3NhZ2UgIT09IGZhbHNlO1xuICAgIGNvbnN0IGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgIGZpbGVSZWFkZXIub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgaW1wb3J0RXJyb3IocGFyYW1zKTtcbiAgICB9O1xuICAgIGZpbGVSZWFkZXIub25sb2FkID0gKGV2bnQpID0+IHtcbiAgICAgICAgY29uc3QgdGFibGVGaWVsZHMgPSBbXTtcbiAgICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gY29sdW1uLmZpZWxkO1xuICAgICAgICAgICAgaWYgKGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgdGFibGVGaWVsZHMucHVzaChmaWVsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB3b3JrYm9vayA9IG5ldyBFeGNlbEpTLldvcmtib29rKCk7XG4gICAgICAgIGNvbnN0IHJlYWRlclRhcmdldCA9IGV2bnQudGFyZ2V0O1xuICAgICAgICBpZiAocmVhZGVyVGFyZ2V0KSB7XG4gICAgICAgICAgICB3b3JrYm9vay54bHN4LmxvYWQocmVhZGVyVGFyZ2V0LnJlc3VsdCkudGhlbih3YiA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlyc3RTaGVldCA9IHdiLndvcmtzaGVldHNbMF07XG4gICAgICAgICAgICAgICAgaWYgKGZpcnN0U2hlZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hlZXRWYWx1ZXMgPSBmaXJzdFNoZWV0LmdldFNoZWV0VmFsdWVzKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkSW5kZXggPSBYRVV0aWxzLmZpbmRJbmRleE9mKHNoZWV0VmFsdWVzLCAobGlzdCkgPT4gbGlzdCAmJiBsaXN0Lmxlbmd0aCA+IDApO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBzaGVldFZhbHVlc1tmaWVsZEluZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gY2hlY2tJbXBvcnREYXRhKHRhYmxlRmllbGRzLCBmaWVsZHMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNvcmRzID0gc2hlZXRWYWx1ZXMuc2xpY2UoZmllbGRJbmRleCkubWFwKGxpc3QgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LmZvckVhY2goKGNlbGxWYWx1ZSwgY0luZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bZmllbGRzW2NJbmRleF1dID0gY2VsbFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlRmllbGRzLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRbZmllbGRdID0gWEVVdGlscy5pc1VuZGVmaW5lZChpdGVtW2ZpZWxkXSkgPyBudWxsIDogaXRlbVtmaWVsZF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRhYmxlLmNyZWF0ZURhdGEocmVjb3JkcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsb2FkUmVzdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlID09PSAnaW5zZXJ0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkUmVzdCA9ICR0YWJsZS5pbnNlcnRBdChkYXRhLCAtMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkUmVzdCA9ICR0YWJsZS5yZWxvYWREYXRhKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9hZFJlc3QudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfaW1wb3J0UmVzb2x2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2ltcG9ydFJlc29sdmUoeyBzdGF0dXM6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3dNc2cgJiYgbW9kYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5tZXNzYWdlKHsgY29udGVudDogdCgndnhlLnRhYmxlLmltcFN1Y2Nlc3MnLCBbcmVjb3Jkcy5sZW5ndGhdKSwgc3RhdHVzOiAnc3VjY2VzcycgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnRFcnJvcihwYXJhbXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpbXBvcnRFcnJvcihwYXJhbXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaW1wb3J0RXJyb3IocGFyYW1zKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKTtcbn1cbmZ1bmN0aW9uIGhhbmRsZUltcG9ydEV2ZW50KHBhcmFtcykge1xuICAgIGlmIChwYXJhbXMub3B0aW9ucy50eXBlID09PSAneGxzeCcpIHtcbiAgICAgICAgaW1wb3J0WExTWChwYXJhbXMpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuZnVuY3Rpb24gaGFuZGxlRXhwb3J0RXZlbnQocGFyYW1zKSB7XG4gICAgaWYgKHBhcmFtcy5vcHRpb25zLnR5cGUgPT09ICd4bHN4Jykge1xuICAgICAgICBleHBvcnRYTFNYKHBhcmFtcyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG4vKipcbiAqIOWfuuS6jiB2eGUtdGFibGUg6KGo5qC855qE5aKe5by65o+S5Lu277yM5pSv5oyB5a+85Ye6IHhsc3gg5qC85byPXG4gKi9cbmV4cG9ydCBjb25zdCBWWEVUYWJsZVBsdWdpbkV4cG9ydFhMU1ggPSB7XG4gICAgaW5zdGFsbCh2eGV0YWJsZWNvcmUpIHtcbiAgICAgICAgY29uc3QgeyBzZXR1cCwgaW50ZXJjZXB0b3IgfSA9IHZ4ZXRhYmxlY29yZTtcbiAgICAgICAgdnhldGFibGUgPSB2eGV0YWJsZWNvcmU7XG4gICAgICAgIHNldHVwKHtcbiAgICAgICAgICAgIGV4cG9ydDoge1xuICAgICAgICAgICAgICAgIHR5cGVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHhsc3g6IDBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpbnRlcmNlcHRvci5taXhpbih7XG4gICAgICAgICAgICAnZXZlbnQuaW1wb3J0JzogaGFuZGxlSW1wb3J0RXZlbnQsXG4gICAgICAgICAgICAnZXZlbnQuZXhwb3J0JzogaGFuZGxlRXhwb3J0RXZlbnRcbiAgICAgICAgfSk7XG4gICAgfVxufTtcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVlhFVGFibGUgJiYgd2luZG93LlZYRVRhYmxlLnVzZSkge1xuICAgIHdpbmRvdy5WWEVUYWJsZS51c2UoVlhFVGFibGVQbHVnaW5FeHBvcnRYTFNYKTtcbn1cbmV4cG9ydCBkZWZhdWx0IFZYRVRhYmxlUGx1Z2luRXhwb3J0WExTWDtcbiJdfQ==
