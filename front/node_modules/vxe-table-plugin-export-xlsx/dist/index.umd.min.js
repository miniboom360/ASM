!function(e,t){"function"==typeof define&&define.amd?define("vxe-table-plugin-export-xlsx",["exports","xe-utils","exceljs"],t):"undefined"!=typeof exports?t(exports,require("xe-utils"),require("exceljs")):(t(t={},e.XEUtils,e.ExcelJS),e.VXETablePluginExportXLSX=t)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e,j,M){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.VXETablePluginExportXLSX=void 0,j=t(j),M=t(M);var N,O="f8f8f9",R="606266",o="thin",n="e8eaec";function A(e,t){if(t){if("seq"===e.type)return j.default.toValueString(t);switch(e.cellType){case"string":return j.default.toValueString(t);case"number":if(isNaN(t))break;return Number(t);default:if(t.length<12&&!isNaN(t))return Number(t)}}return t}function D(e,t){t&&(e.height=j.default.floor(.75*t,12))}function I(e,t){e.protection={locked:!1},e.alignment={vertical:"middle",horizontal:t||"left"}}function L(){return{top:{style:o,color:{argb:n}},left:{style:o,color:{argb:n}},bottom:{style:o,color:{argb:n}},right:{style:o,color:{argb:n}}}}function r(e){function t(){var e=new M.default.Workbook,n=e.addWorksheet(m);e.creator="vxe-table",n.columns=T,b&&n.addRows(C).forEach(function(e){y&&D(e,h),e.eachCell(function(e){var t=n.getColumn(e.col),t=r.getColumnById(t.key),o=t.headerAlign,t=t.align;I(e,o||t||d||g),y&&Object.assign(e,{font:{bold:!0,color:{argb:R}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:O}},border:L()})})}),n.addRows(_).forEach(function(e){y&&D(e,h),e.eachCell(function(e){var t=n.getColumn(e.col),t=r.getColumnById(t.key);t&&(I(e,t.align||g),y&&Object.assign(e,{font:{color:{argb:R}},border:L()}))})}),x&&n.addRows(S).forEach(function(e){y&&D(e,h),e.eachCell(function(e){var t,o=n.getColumn(e.col),o=r.getColumnById(o.key);o&&(t=o.footerAlign,o=o.align,I(e,t||o||p||g),y&&Object.assign(e,{font:{color:{argb:R}},border:L()}))})}),y&&E&&E({options:u,workbook:e,worksheet:n,columns:f,colgroups:a,datas:l,$table:r}),X.forEach(function(e){var t=e.s,e=e.e;n.mergeCells(t.r+1,t.c+1,e.r+1,e.c+1)}),e.xlsx.writeBuffer().then(function(e){var t,e=new Blob([e],{type:"application/octet-stream"}),o=u,n=(r=N).modal,r=r.t,a=o.message,l=o.filename,o=o.type,a=!1!==a;window.Blob?navigator.msSaveBlob?navigator.msSaveBlob(e,"".concat(l,".").concat(o)):((t=document.createElement("a")).target="_blank",t.download="".concat(l,".").concat(o),t.href=URL.createObjectURL(e),document.body.appendChild(t),t.click(),document.body.removeChild(t)):a&&n&&n.alert({content:r("vxe.error.notExp"),status:"error"}),k&&s&&(s.close(i),s.message({content:c("vxe.table.expSuccess"),status:"success"}))})}var o,i="xlsx",n=N,s=n.modal,c=n.t,r=e.$table,u=e.options,f=e.columns,a=e.colgroups,l=e.datas,n=r.props,e=r.reactData,d=n.headerAlign,g=n.align,p=n.footerAlign,h=e.rowHeight,n=u.message,m=u.sheetName,b=u.isHeader,x=u.isFooter,e=u.isMerge,v=u.isColgroup,w=u.original,y=u.useStyle,E=u.sheetMethod,k=!1!==n,n=r.getMergeCells(),C=[],S=[],T=[],X=[],V=0,B={},_=(f.forEach(function(e){var t=e.id,o=e.field,n=e.renderWidth;B[t]=w?o:e.getTitle(),T.push({key:t,width:j.default.ceil(n/8,1)})}),b&&(v&&!w&&a?a.forEach(function(e,a){var l={};f.forEach(function(e){l[e.id]=null}),e.forEach(function(e){var t=e._colSpan,o=e._rowSpan,n=function e(t){var o=t.childNodes;return o&&o.length?e(o[0]):t}(e),r=f.indexOf(n);l[n.id]=w?n.field:e.getTitle(),(1<t||1<o)&&X.push({s:{r:a,c:r},e:{r:a+o-1,c:r+t-1}})}),C.push(l)}):C.push(B),V+=C.length),e&&!w&&n.forEach(function(e){var t=e.row,o=e.rowspan,n=e.col,e=e.colspan;X.push({s:{r:t+V,c:n},e:{r:t+V+o-1,c:n+e-1}})}),l.map(function(t){var o={};return f.forEach(function(e){o[e.id]=A(e,t[e.id])}),o}));V+=_.length,x&&(v=r.getTableData().footerData,n=v,v=(o=u.footerFilterMethod)?n.filter(function(e,t){return o({items:e,$rowIndex:t})}):n,n=r.getMergeFooterItems(),e&&!w&&n.forEach(function(e){var t=e.row,o=e.rowspan,n=e.col,e=e.colspan;X.push({s:{r:t+V,c:n},e:{r:t+V+o-1,c:n+e-1}})}),v.forEach(function(t){var o={};f.forEach(function(e){o[e.id]=A(e,t[r.getVMColumnIndex(e)])}),S.push(o)}));k&&s?(s.message({id:i,content:c("vxe.table.expLoading"),status:"loading",duration:-1}),setTimeout(t,1500)):t()}function d(e){var t=N,o=t.modal,t=t.t,n=e.$table,e=e.options,n=n.internalData._importReject;!1!==e.message&&o&&o.message({content:t("vxe.error.impFields"),status:"error"}),n&&n({status:!1})}function a(a){var e=N,l=e.modal,i=e.t,s=a.$table,o=a.columns,c=a.options,e=a.file,u=s.internalData._importResolve,f=!1!==c.message,t=new FileReader;t.onerror=function(){d(a)},t.onload=function(e){var r=[],t=(o.forEach(function(e){e=e.field;e&&r.push(e)}),new M.default.Workbook),e=e.target;e?t.xlsx.load(e.result).then(function(e){var t,n,o,e=e.worksheets[0];e&&(e=e.getSheetValues(),t=j.default.findIndexOf(e,function(e){return e&&0<e.length}),n=e[t],o=r,n.some(function(e){return-1<o.indexOf(e)}))?(e=e.slice(t).map(function(e){var o={},t=(e.forEach(function(e,t){o[n[t]]=e}),{});return r.forEach(function(e){t[e]=j.default.isUndefined(o[e])?null:o[e]}),t}),s.createData(e).then(function(e){e="insert"===c.mode?s.insertAt(e,-1):s.reloadData(e);return e.then(function(){u&&u({status:!0})})}),f&&l&&l.message({content:i("vxe.table.impSuccess",[e.length]),status:"success"})):d(a)}):d(a)},t.readAsArrayBuffer(e)}function l(e){if("xlsx"===e.options.type)return a(e),!1}function i(e){if("xlsx"===e.options.type)return r(e),!1}var s={install:function(e){var t=e.setup,o=e.interceptor;N=e,t({export:{types:{xlsx:0}}}),o.mixin({"event.import":l,"event.export":i})}};e.VXETablePluginExportXLSX=s,"undefined"!=typeof window&&window.VXETable&&window.VXETable.use&&window.VXETable.use(s);e.default=s});